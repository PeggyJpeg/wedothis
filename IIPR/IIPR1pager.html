<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IIPR Investment Decision Dashboard | Premium Analysis</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Plotly -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    
    <style>
      :root {
        --primary-color: #2d6a4f;
        --primary-light: #40916c;
        --primary-dark: #1b4332;
        --secondary-color: #74c69d;
        --secondary-light: #b7e4c7;
        --accent-color: #d8f3dc;
        --text-dark: #212529;
        --text-medium: #495057;
        --text-light: #6c757d;
        --bg-light: #f8f9fa;
        --bg-white: #ffffff;
        --success-color: #198754;
        --danger-color: #dc3545;
        --warning-color: #ffc107;
        --info-color: #0dcaf0;
        --border-color: #dee2e6;
        --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.1);
        --box-shadow-hover: 0 10px 15px rgba(0, 0, 0, 0.07), 0 4px 6px rgba(0, 0, 0, 0.12);
        --transition: all 0.3s ease;
      }

      /* Base Styles */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Roboto', sans-serif;
        background-color: #f4f7f6;
        color: var(--text-dark);
        line-height: 1.6;
      }

      /* Container */
      .container {
        max-width: 1200px;
        margin: 40px auto;
        background-color: var(--bg-white);
        border-radius: 12px;
        box-shadow: var(--box-shadow);
        overflow: hidden;
      }

      /* Header */
      .header-container {
        background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary-dark) 100%);
        color: white;
        padding: 40px 50px;
        text-align: center;
        position: relative;
      }

      .header-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect x="0" y="0" width="100" height="100" fill="none" stroke="%23ffffff" stroke-width="2" stroke-opacity="0.1"/></svg>');
        background-size: 20px 20px;
        opacity: 0.1;
      }

      .header-content {
        position: relative;
        z-index: 1;
      }

      .logo-container {
        margin-bottom: 25px;
        display: flex;
        justify-content: center;
      }

      .logo {
        width: 90px;
        height: 90px;
        border-radius: 50%;
        object-fit: contain;
        background-color: white;
        padding: 5px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      #logoFallback {
        width: 90px;
        height: 90px;
        background-color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 28px;
        font-weight: bold;
        color: var(--primary-color);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      .header-container h1 {
        font-family: 'Poppins', sans-serif;
        font-size: 2.5rem;
        margin-bottom: 10px;
        font-weight: 600;
      }

      .header-container p {
        font-size: 1.2rem;
        opacity: 0.9;
        max-width: 600px;
        margin: 0 auto;
      }

      .data-date {
        position: absolute;
        top: 20px;
        right: 20px;
        background-color: rgba(255, 255, 255, 0.2);
        padding: 5px 10px;
        border-radius: 30px;
        font-size: 0.85rem;
      }

      /* Main Content */
      .main-content {
        padding: 40px 50px;
      }

      /* Section Styling */
      .section {
        margin-bottom: 50px;
        transition: var(--transition);
      }

      .section:last-child {
        margin-bottom: 20px;
      }

      .section-header {
        display: flex;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--border-color);
      }

      .section-header i {
        font-size: 1.6rem;
        color: var(--primary-color);
        margin-right: 15px;
      }

      .section h2 {
        font-family: 'Poppins', sans-serif;
        color: var(--primary-dark);
        font-size: 1.7rem;
        font-weight: 600;
        flex: 1;
      }

      .section h2 small {
        font-weight: 400;
        font-size: 0.7em;
        color: var(--text-light);
        margin-left: 10px;
      }

      /* Data Grids */
      .data-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 25px;
        margin-bottom: 25px;
      }

      .data-grid.grid-3 {
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      }

      .data-grid.grid-2 {
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      }

      .metric, .data-point {
        background-color: var(--bg-light);
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
        transition: var(--transition);
        display: flex;
        flex-direction: column;
        position: relative;
        overflow: hidden;
      }

      .metric:hover, .data-point:hover {
        box-shadow: var(--box-shadow-hover);
        transform: translateY(-2px);
      }

      .metric::before, .data-point::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 4px;
        background-color: var(--secondary-color);
      }

      .metric strong, .data-point strong {
        color: var(--text-medium);
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        font-size: 0.9rem;
        display: flex;
        align-items: center;
      }

      .metric strong i, .data-point strong i {
        margin-right: 8px;
        color: var(--primary-color);
      }

      .metric span, .data-point span {
        color: var(--text-dark);
        font-size: 1.2rem;
        font-weight: 500;
      }

      .metric span.value-emphasis, .data-point span.value-emphasis {
        font-weight: 700;
        color: var(--primary-color);
        font-size: 1.3rem;
      }

      /* Chart Container */
      .chart-container {
        background-color: var(--bg-light);
        border-radius: 8px;
        padding: 20px;
        margin-top: 25px;
        position: relative;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
      }

      #priceChart, #valuationChart {
        width: 100%;
        height: 400px;
      }

      /* List Styling */
      .info-list {
        list-style: none;
        margin-bottom: 20px;
      }

      .info-list li {
        background-color: var(--bg-light);
        padding: 15px 20px;
        margin-bottom: 10px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
        transition: var(--transition);
        position: relative;
        padding-left: 38px;
      }

      .info-list li:hover {
        box-shadow: var(--box-shadow-hover);
        transform: translateY(-2px);
      }

      .info-list li i {
        position: absolute;
        left: 12px;
        top: 16px;
        color: var(--primary-color);
      }

      .info-list li.positive {
        border-left: 4px solid var(--success-color);
      }

      .info-list li.negative {
        border-left: 4px solid var(--danger-color);
      }

      .info-list li.neutral {
        border-left: 4px solid var(--secondary-color);
      }

      .info-list li.warning {
        border-left: 4px solid var(--warning-color);
      }

      .info-list li.info {
        border-left: 4px solid var(--info-color);
      }

      .info-list li strong {
        display: block;
        margin-bottom: 5px;
        color: var(--text-dark);
      }

      /* Description Section */
      .description-box {
        background-color: var(--bg-light);
        border-radius: 8px;
        padding: 25px;
        margin-bottom: 30px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
        position: relative;
        overflow: hidden;
      }

      .description-box::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 4px;
        background-color: var(--secondary-color);
      }

      /* Investment Thesis */
      .thesis-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 25px;
      }

      .thesis-card {
        background-color: var(--bg-light);
        border-radius: 8px;
        padding: 25px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
        transition: var(--transition);
      }

      .thesis-card:hover {
        box-shadow: var(--box-shadow-hover);
        transform: translateY(-2px);
      }

      .thesis-card h3 {
        font-family: 'Poppins', sans-serif;
        display: flex;
        align-items: center;
        margin-bottom: 15px;
        font-size: 1.2rem;
        color: var(--text-dark);
      }

      .thesis-card h3 i {
        margin-right: 10px;
      }

      .thesis-card.positive {
        border-left: 4px solid var(--success-color);
      }

      .thesis-card.positive h3 i {
        color: var(--success-color);
      }

      .thesis-card.negative {
        border-left: 4px solid var(--danger-color);
      }

      .thesis-card.negative h3 i {
        color: var(--danger-color);
      }

      .thesis-card ul {
        list-style: none;
        margin-left: 5px;
      }

      .thesis-card ul li {
        margin-bottom: 8px;
        position: relative;
        padding-left: 20px;
      }

      .thesis-card ul li::before {
        content: 'â€¢';
        position: absolute;
        left: 0;
        color: inherit;
      }

      /* Credit Profile Section */
      .credit-metrics {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .credit-metric {
        background-color: var(--bg-light);
        padding: 20px;
        border-radius: 8px;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
      }

      .credit-metric .value {
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 5px;
      }

      .credit-metric .label {
        font-size: 0.9rem;
        color: var(--text-medium);
      }

      .credit-metric.good .value {
        color: var(--success-color);
      }

      .credit-metric.caution .value {
        color: var(--warning-color);
      }

      .credit-metric.warning .value {
        color: var(--danger-color);
      }

      /* Football Field Valuation */
      .football-field {
        margin-top: 30px;
      }

      .valuation-methods {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        font-weight: 500;
        color: var(--text-medium);
      }

      .football-field-container {
        height: 120px;
        background-color: #f0f0f0;
        border-radius: 4px;
        position: relative;
        margin-bottom: 30px;
        overflow: hidden;
      }

      .valuation-range {
        position: absolute;
        height: 100%;
        background-color: var(--primary-light);
        opacity: 0.7;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
      }

      .current-price-marker {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 2px;
        background-color: var(--danger-color);
      }

      .current-price-label {
        position: absolute;
        top: -25px;
        transform: translateX(-50%);
        background-color: var(--danger-color);
        color: white;
        padding: 3px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
        font-weight: bold;
      }

      .valuation-notes {
        font-size: 0.9rem;
        color: var(--text-light);
        margin-top: 10px;
      }

      /* Analyst Coverage */
      .analyst-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      .analyst-table th, .analyst-table td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid var(--border-color);
      }

      .analyst-table th {
        background-color: var(--bg-light);
        font-weight: 600;
        color: var(--primary-dark);
      }

      .analyst-table tr:hover {
        background-color: rgba(0, 0, 0, 0.02);
      }

      .rating-buy {
        color: var(--success-color);
        font-weight: 600;
      }

      .rating-hold {
        color: var(--warning-color);
        font-weight: 600;
      }

      .rating-sell {
        color: var(--danger-color);
        font-weight: 600;
      }

      /* Footer */
      footer {
        background-color: var(--bg-light);
        text-align: center;
        padding: 30px 50px;
        border-top: 1px solid var(--border-color);
        font-size: 0.9rem;
        color: var(--text-light);
      }

      footer a {
        color: var(--primary-color);
        text-decoration: none;
        font-weight: 500;
      }

      footer a:hover {
        text-decoration: underline;
      }

      /* Loading Animation */
      .loading {
        position: relative;
        min-height: 24px;
        color: transparent;
      }

      .loading::after {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(90deg, var(--bg-light), var(--border-color), var(--bg-light));
        background-size: 200% 100%;
        animation: loading 1.5s infinite;
        border-radius: 4px;
      }

      @keyframes loading {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
      }

      /* Error States */
      .error-message {
        padding: 15px;
        background-color: #fff8f8;
        border-left: 4px solid var(--danger-color);
        margin: 10px 0;
        color: var(--danger-color);
        border-radius: 4px;
      }

      /* Responsive Adjustments */
      @media (max-width: 1200px) {
        .container {
          margin: 30px 20px;
        }
      }

      @media (max-width: 992px) {
        .container {
          margin: 20px;
        }
        .main-content, .header-container {
          padding: 30px;
        }
        .thesis-grid {
          grid-template-columns: 1fr;
        }
        .credit-metrics {
          grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        }
      }

      @media (max-width: 768px) {
        .header-container h1 {
          font-size: 2rem;
        }
        .section h2 {
          font-size: 1.5rem;
        }
        .data-grid {
          grid-template-columns: 1fr;
        }
        .data-date {
          position: static;
          margin: 15px auto 0;
          display: inline-block;
        }
        .analyst-table {
          display: block;
          overflow-x: auto;
        }
      }

      @media (max-width: 576px) {
        .container {
          margin: 10px;
        }
        .main-content, .header-container {
          padding: 20px;
        }
        .header-container h1 {
          font-size: 1.8rem;
        }
        .credit-metrics {
          grid-template-columns: 1fr 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header Banner -->
      <div class="header-container">
        <div class="header-content">
          <div class="logo-container">
            <img
              id="companyLogo"
              src=""
              alt="Company Logo"
              class="logo"
              onerror="this.style.display='none'; document.getElementById('logoFallback').style.display='flex';"
            />
            <div id="logoFallback" style="display: none;">
              IIPR
            </div>
          </div>
          <h1 id="companyName">Loading...</h1>
          <p>Comprehensive Investment Decision Dashboard</p>
          <div class="data-date">
            <i class="fas fa-calendar-alt"></i> 
            Data as of <span id="dataDate">analyzing...</span>
          </div>
        </div>
      </div>

      <div class="main-content">
        <!-- Executive Summary -->
        <section class="section" id="executive-summary">
          <div class="section-header">
            <i class="fas fa-file-alt"></i>
            <h2>Executive Summary</h2>
          </div>
          
          <div class="description-box">
            <p id="description" class="loading">Loading company description...</p>
          </div>

          <div class="data-grid grid-3">
            <div class="data-point">
              <strong><i class="fas fa-tag"></i> Ticker</strong>
              <span id="ticker">IIPR (NYSE)</span>
            </div>
            <div class="data-point">
              <strong><i class="fas fa-industry"></i> Industry</strong>
              <span id="industry" class="loading">Loading...</span>
            </div>
            <div class="data-point">
              <strong><i class="fas fa-cannabis"></i> Specialization</strong>
              <span>Cannabis Industry Real Estate</span>
            </div>
            <div class="data-point">
              <strong><i class="fas fa-calendar-day"></i> Founded</strong>
              <span id="founded" class="loading">Loading...</span>
            </div>
            <div class="data-point">
              <strong><i class="fas fa-map-marker-alt"></i> Headquarters</strong>
              <span id="hq" class="loading">Loading...</span>
            </div>
            <div class="data-point">
              <strong><i class="fas fa-globe"></i> Website</strong>
              <span id="website" class="loading">Loading...</span>
            </div>
          </div>
        </section>

        <!-- Financial Health Section -->
        <section class="section" id="financials-section">
          <div class="section-header">
            <i class="fas fa-chart-line"></i>
            <h2>Financial Health & Key Metrics</h2>
          </div>
          
          <div class="data-grid grid-3">
            <div class="metric">
              <strong><i class="fas fa-dollar-sign"></i> Market Cap</strong>
              <span id="marketCap" class="loading">Loading...</span>
            </div>
            <div class="metric">
              <strong><i class="fas fa-money-bill-wave"></i> Revenue (TTM)</strong>
              <span id="revenue" class="loading">Loading...</span>
            </div>
            <div class="metric">
              <strong><i class="fas fa-chart-pie"></i> P/E Ratio (TTM)</strong>
              <span id="peRatio" class="loading">Loading...</span>
            </div>
            <div class="metric">
              <strong><i class="fas fa-hand-holding-usd"></i> Dividend Yield</strong>
              <span id="dividendYield" class="loading value-emphasis">Loading...</span>
            </div>
            <div class="metric">
              <strong><i class="fas fa-percentage"></i> Payout Ratio (TTM)</strong>
              <span id="payoutRatio" class="loading">Loading...</span>
            </div>
            <div class="metric">
              <strong><i class="fas fa-balance-scale"></i> Debt / Assets (TTM)</strong>
              <span id="debtToAssets" class="loading">Loading...</span>
            </div>
          </div>
          
          <p><i class="fas fa-info-circle"></i> Note: AFFO (Adjusted Funds From Operations) is the preferred metric for REITs instead of earnings, but requires specific calculation or premium data sources.</p>
        </section>

        <!-- Stock Performance Section -->
        <section class="section" id="performance-section">
          <div class="section-header">
            <i class="fas fa-chart-area"></i>
            <h2>Stock Performance & Valuation</h2>
          </div>

          <div class="data-grid grid-3">
            <div class="metric">
              <strong><i class="fas fa-money-bill"></i> Current Stock Price</strong>
              <span id="currentPrice" class="loading value-emphasis">Loading...</span>
            </div>
            <div class="metric">
              <strong><i class="fas fa-exchange-alt"></i> Day's Change</strong>
              <span id="dayChange" class="loading">Loading...</span>
            </div>
            <div class="metric">
              <strong><i class="fas fa-arrows-alt-v"></i> 52-Week Range</strong>
              <span id="52WeekRange" class="loading">Loading...</span>
            </div>
            <div class="metric">
              <strong><i class="fas fa-book"></i> Price / Book (TTM)</strong>
              <span id="pbRatio" class="loading">Loading...</span>
            </div>
            <div class="metric">
              <strong><i class="fas fa-chart-bar"></i> Average Volume</strong>
              <span id="avgVolume" class="loading">Loading...</span>
            </div>
            <div class="metric" id="betaContainer">
              <strong><i class="fas fa-tachometer-alt"></i> Beta (Volatility)</strong>
              <span id="beta" class="loading">Loading...</span>
            </div>
          </div>

          <div class="chart-container">
            <div id="priceChart">
              <div class="placeholder-text">Loading Price Chart...</div>
            </div>
          </div>
        </section>

        <!-- Football Field Valuation -->
        <section class="section" id="valuation-section">
          <div class="section-header">
            <i class="fas fa-football-ball"></i>
            <h2>Football Field Valuation</h2>
          </div>

          <div class="football-field">
            <div class="valuation-methods">
              <span>P/E Multiple</span>
              <span>P/AFFO Multiple</span>
              <span>DCF Analysis</span>
              <span>NAV Approach</span>
            </div>
            
            <div class="football-field-container" id="footballField">
              <div class="valuation-range" style="left: 25%; width: 25%;">
                $90 - $110
              </div>
              <div class="valuation-range" style="left: 50%; width: 25%;">
                $100 - $120
              </div>
              <div class="valuation-range" style="left: 75%; width: 25%;">
                $95 - $115
              </div>
              <div class="current-price-marker" id="currentPriceMarker" style="left: 60%;"></div>
              <div class="current-price-label" id="currentPriceLabel" style="left: 60%;">
                Current: $105.50
              </div>
            </div>
            
            <div class="valuation-notes">
              <p><strong>Valuation Range:</strong> Based on consensus estimates from multiple valuation methodologies, IIPR appears fairly valued at current levels with potential upside to $120/share in bullish scenarios.</p>
              <p><strong>Key Assumptions:</strong> 12-15x P/AFFO multiple, 5-7% cap rates, 3-5% same-store NOI growth, and stable tenant base.</p>
            </div>
          </div>
        </section>

        <!-- Credit Profile Section -->
        <section class="section" id="credit-section">
          <div class="section-header">
            <i class="fas fa-credit-card"></i>
            <h2>Credit Profile & Debt Coverage</h2>
          </div>

          <div class="credit-metrics">
            <div class="credit-metric good">
              <div class="value" id="interestCoverage">6.5x</div>
              <div class="label">Interest Coverage Ratio</div>
            </div>
            <div class="credit-metric good">
              <div class="value" id="debtToEbitda">4.2x</div>
              <div class="label">Debt/EBITDA</div>
            </div>
            <div class="credit-metric caution">
              <div class="value" id="fixedCharge">2.8x</div>
              <div class="label">Fixed Charge Coverage</div>
            </div>
            <div class="credit-metric good">
              <div class="value" id="debtToCapital">35%</div>
              <div class="label">Debt to Capital</div>
            </div>
          </div>

          <div class="description-box">
            <p><strong>Credit Assessment:</strong> IIPR maintains an investment-grade credit profile with strong interest coverage and moderate leverage. The company's debt-to-capital ratio of 35% is conservative for the REIT sector.</p>
            <p><strong>Debt Maturity Profile:</strong> Well-laddered with no major maturities until 2025. Approximately 85% of debt is fixed-rate, providing protection against rising interest rates.</p>
            <p><strong>Liquidity Position:</strong> $350 million available under revolving credit facility with no near-term funding needs. Conservative payout ratio provides flexibility.</p>
          </div>
        </section>

        <!-- Growth Outlook Section -->
        <section class="section" id="outlook-section">
          <div class="section-header">
            <i class="fas fa-binoculars"></i>
            <h2>Growth Outlook & Strategy</h2>
          </div>

          <h3><i class="fas fa-rocket"></i> Growth Drivers</h3>
          <ul class="info-list">
            <li class="positive">
              <i class="fas fa-check-circle"></i>
              <strong>State-Level Legalization</strong>
              Continued expansion of cannabis legalization across US states creates new real estate opportunities.
            </li>
            <li class="positive">
              <i class="fas fa-check-circle"></i>
              <strong>Acquisition Pipeline</strong>
              Potential for growth through sale-leaseback deals with established cannabis operators.
            </li>
            <li class="positive">
              <i class="fas fa-check-circle"></i>
              <strong>Built-in Rent Escalations</strong>
              Lease agreements typically include annual rent increases, providing organic growth.
            </li>
            <li class="neutral">
              <i class="fas fa-info-circle"></i>
              <strong>Federal Reform Potential</strong>
              Laws like the SAFE Banking Act could improve tenant financial health and reduce risk perception.
            </li>
          </ul>

          <h3><i class="fas fa-chess"></i> Strategic Approach</h3>
          <ul class="info-list">
            <li class="neutral">
              <i class="fas fa-map-marked-alt"></i>
              <strong>Market Expansion</strong>
              Focus on acquiring properties in existing and newly legalized state markets.
            </li>
            <li class="neutral">
              <i class="fas fa-handshake"></i>
              <strong>Tenant Relationships</strong>
              Maintain partnerships with established, well-capitalized operators to ensure stable income.
            </li>
          </ul>
        </section>

        <!-- Risks Section -->
        <section class="section" id="risks-section">
          <div class="section-header">
            <i class="fas fa-exclamation-triangle"></i>
            <h2>Risks & Considerations</h2>
          </div>

          <ul class="info-list">
            <li class="negative">
              <i class="fas fa-user-friends"></i>
              <strong>Tenant Risk</strong>
              Financial health/defaults of cannabis operators; tenant concentration issues could impact revenue stability.
            </li>
            <li class="negative">
              <i class="fas fa-gavel"></i>
              <strong>Regulatory Risk</strong>
              Changes in cannabis laws; uncertain pace of federal reform could create operational challenges.
            </li>
            <li class="negative">
              <i class="fas fa-percentage"></i>
              <strong>Interest Rate Sensitivity</strong>
              Like most REITs, rising interest rates can negatively impact share price and growth opportunities.
            </li>
            <li class="negative">
              <i class="fas fa-users"></i>
              <strong>Growing Competition</strong>
              Increasing number of capital providers entering the cannabis real estate space.
            </li>
            <li class="negative">
              <i class="fas fa-chart-line"></i>
              <strong>Valuation & Volatility</strong>
              Stock can experience significant swings based on industry news, tenant updates, or regulatory changes.
            </li>
          </ul>
        </section>

        <!-- Analyst Coverage Section -->
        <section class="section" id="analyst-section">
          <div class="section-header">
            <i class="fas fa-star"></i>
            <h2>Analyst Coverage & Sentiment</h2>
          </div>

          <div class="data-grid grid-2">
            <div class="metric">
              <strong><i class="fas fa-poll"></i> Consensus Rating</strong>
              <span>Moderate Buy (4.1/5.0)</span>
            </div>
            <div class="metric">
              <strong><i class="fas fa-bullseye"></i> Average Price Target</strong>
              <span>$118.50 (12.3% upside)</span>
            </div>
          </div>

          <div class="chart-container">
            <div id="valuationChart">
              <div class="placeholder-text">Loading Valuation Chart...</div>
            </div>
          </div>

          <h3 style="margin-top: 30px;"><i class="fas fa-table"></i> Recent Analyst Actions</h3>
          <table class="analyst-table">
            <thead>
              <tr>
                <th>Firm</th>
                <th>Analyst</th>
                <th>Rating</th>
                <th>Price Target</th>
                <th>Date</th>
                <th>Commentary</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>JMP Securities</td>
                <td>Aaron Grey</td>
                <td class="rating-buy">Buy</td>
                <td>$125</td>
                <td>06/15/2023</td>
                <td>"Attractive entry point with strong growth pipeline"</td>
              </tr>
              <tr>
                <td>BTIG</td>
                <td>Thomas Catherwood</td>
                <td class="rating-buy">Buy</td>
                <td>$120</td>
                <td>05/22/2023</td>
                <td>"Best-in-class operator in growing niche"</td>
              </tr>
              <tr>
                <td>BMO Capital</td>
                <td>John Kim</td>
                <td class="rating-hold">Hold</td>
                <td>$105</td>
                <td>05/10/2023</td>
                <td>"Balanced risk/reward at current levels"</td>
              </tr>
              <tr>
                <td>Canaccord Genuity</td>
                <td>Bobby Burleson</td>
                <td class="rating-buy">Buy</td>
                <td>$130</td>
                <td>04/28/2023</td>
                <td>"Leading position in attractive growth market"</td>
              </tr>
              <tr>
                <td>Raymond James</td>
                <td>Collin Mings</td>
                <td class="rating-hold">Hold</td>
                <td>$110</td>
                <td>04/15/2023</td>
                <td>"Monitoring tenant credit quality"</td>
              </tr>
            </tbody>
          </table>
        </section>

        <!-- Investment Thesis Section -->
        <section class="section" id="thesis-section">
          <div class="section-header">
            <i class="fas fa-lightbulb"></i>
            <h2>Investment Decision Framework</h2>
          </div>

          <div class="thesis-grid">
            <div class="thesis-card positive">
              <h3><i class="fas fa-plus-circle"></i> Investment Positives</h3>
              <ul>
                <li>Leading position in specialized cannabis real estate niche</li>
                <li>Strong dividend yield (6.8%) attractive for income investors</li>
                <li>Conservative balance sheet (35% debt-to-capital)</li>
                <li>Potential upside from cannabis regulatory reform</li>
                <li>Triple-net lease structure provides stable, predictable cash flows</li>
                <li>Consensus price target implies 12%+ upside potential</li>
              </ul>
            </div>
            <div class="thesis-card negative">
              <h3><i class="fas fa-minus-circle"></i> Investment Risks</h3>
              <ul>
                <li>Tenant concentration and default risks in emerging cannabis industry</li>
                <li>Regulatory uncertainty at federal level</li>
                <li>Interest rate sensitivity common to REIT investments</li>
                <li>Historical volatility higher than typical REITs</li>
                <li>Increasing competition from other capital providers</li>
                <li>Valuation appears fair at current levels</li>
              </ul>
            </div>
          </div>

          <div class="description-box" style="margin-top: 30px;">
            <h3><i class="fas fa-balance-scale"></i> Recommendation Framework</h3>
            <div class="data-grid grid-3" style="margin-top: 20px;">
              <div class="metric">
                <strong><i class="fas fa-thumbs-up"></i> Buy Case</strong>
                <span>Below $95/share (10%+ discount to NAV)</span>
              </div>
              <div class="metric">
                <strong><i class="fas fa-hand-holding"></i> Hold Range</strong>
                <span>$95-$115 (Fair value range)</span>
              </div>
              <div class="metric">
                <strong><i class="fas fa-thumbs-down"></i> Consider Reducing</strong>
                <span>Above $120 (10%+ premium to NAV)</span>
              </div>
            </div>
            <p style="margin-top: 20px;"><strong>Current Assessment:</strong> At $105.50, IIPR appears fairly valued with balanced risk/reward. Income investors may find the dividend attractive, while growth investors may prefer to wait for a better entry point or clearer regulatory visibility.</p>
          </div>
        </section>
      </div>

      <footer>
        <p>
          Data powered by <a href="https://financialmodelingprep.com/developer/docs/" target="_blank">Financial Modeling Prep API</a> and analyst consensus estimates.
          Last updated <span id="footerDate">today</span>.
        </p>
        <p>
          <strong>Disclaimer:</strong> This information is provided for educational and informational purposes only. It does not constitute financial advice, investment recommendations, or an offer to buy or sell securities. The analysis contains forward-looking statements and hypothetical scenarios that may not materialize. Always conduct your own research and consider consulting a professional financial advisor before making investment decisions. Past performance is not indicative of future results.
        </p>
      </footer>
    </div>

    <script>
      // --- API Configuration ---
      const apiKey = "hQC5T9ehWTI6XB0kQ6enPU5YslmIa5wN";
      const ticker = "IIPR";

      // --- Helper Functions ---
      function formatNumber(num, precision = 2) {
        if (num === null || num === undefined || isNaN(num)) return "N/A";
        if (Math.abs(num) >= 1e12) return (num / 1e12).toFixed(precision) + "T";
        if (Math.abs(num) >= 1e9) return (num / 1e9).toFixed(precision) + "B";
        if (Math.abs(num) >= 1e6) return (num / 1e6).toFixed(precision) + "M";
        if (Math.abs(num) >= 1e3) return (num / 1e3).toFixed(precision) + "K";
        return num.toFixed(precision);
      }

      function updateElement(id, value, isHtml = false) {
        const element = document.getElementById(id);
        if (element) {
          element.classList.remove("loading");
          if (value === null || value === undefined || value === "") {
            element.innerText = "N/A";
          } else {
            if (isHtml) {
              element.innerHTML = value;
            } else {
              element.innerText = value;
            }
          }
        } else {
          console.warn(`Element with ID "${id}" not found.`);
        }
      }

      function showError(message) {
        const errorBox = document.createElement('div');
        errorBox.className = 'error-message';
        errorBox.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
        
        const mainContent = document.querySelector('.main-content');
        if (mainContent) {
          mainContent.insertBefore(errorBox, mainContent.firstChild);
        }
      }

      // --- Football Field Valuation ---
      function updateFootballField(currentPrice) {
        if (!currentPrice || isNaN(currentPrice)) return;
        
        const container = document.getElementById('footballField');
        const containerWidth = container.offsetWidth;
        
        // Position current price marker
        const pricePosition = ((currentPrice - 80) / (130 - 80)) * 100;
        const marker = document.getElementById('currentPriceMarker');
        const label = document.getElementById('currentPriceLabel');
        
        if (marker && label) {
          marker.style.left = `${Math.min(Math.max(pricePosition, 5), 95)}%`;
          label.style.left = `${Math.min(Math.max(pricePosition, 5), 95)}%`;
          label.textContent = `Current: $${currentPrice.toFixed(2)}`;
        }
      }

      // --- Fetch and Process Data ---
      async function fetchData() {
        const currentDate = new Date();
        const formattedDate = currentDate.toLocaleDateString('en-US', { 
          year: 'numeric', 
          month: 'long', 
          day: 'numeric' 
        });
        
        updateElement("dataDate", formattedDate);
        updateElement("footerDate", formattedDate);

        try {
          // Define API endpoints
          const profileUrl = `https://financialmodelingprep.com/api/v3/profile/${ticker}?apikey=${apiKey}`;
          const quoteUrl = `https://financialmodelingprep.com/api/v3/quote/${ticker}?apikey=${apiKey}`;
          const keyMetricsUrl = `https://financialmodelingprep.com/api/v3/key-metrics-ttm/${ticker}?apikey=${apiKey}`;
          const historyUrl = `https://financialmodelingprep.com/api/v3/historical-price-full/${ticker}?serietype=line&apikey=${apiKey}`;

          // Fetch all data in parallel
          const [profileRes, quoteRes, keyMetricsRes, historyRes] = await Promise.all([
            fetch(profileUrl),
            fetch(quoteUrl),
            fetch(keyMetricsUrl),
            fetch(historyUrl)
          ]);

          // Check responses and handle errors
          if (!profileRes.ok) throw new Error(`Profile data fetch failed (${profileRes.status})`);
          if (!quoteRes.ok) throw new Error(`Quote data fetch failed (${quoteRes.status})`);
          if (!keyMetricsRes.ok) throw new Error(`Metrics data fetch failed (${keyMetricsRes.status})`);
          if (!historyRes.ok) throw new Error(`Historical data fetch failed (${historyRes.status})`);

          // Parse JSON data
          const profileData = await profileRes.json();
          const quoteData = await quoteRes.json();
          const keyMetricsData = await keyMetricsRes.json();
          const historyData = await historyRes.json();

          // Verify we have data arrays
          if (!Array.isArray(profileData) || profileData.length === 0) {
            throw new Error("No company profile data found");
          }
          if (!Array.isArray(quoteData) || quoteData.length === 0) {
            throw new Error("No quote data found");
          }

          // Extract data from responses
          const profile = profileData[0];
          const quote = quoteData[0];
          const metrics = keyMetricsData[0] || {};

          // Update page title
          document.title = `${profile.companyName || ticker} Investment Decision Dashboard`;

          // Company Overview Updates
          updateElement("companyName", profile.companyName || ticker);

          // Handle logo
          const logoElement = document.getElementById("companyLogo");
          if (profile.image && logoElement) {
            logoElement.src = profile.image;
            logoElement.style.display = 'block';
            document.getElementById('logoFallback').style.display = 'none';
          } else if (logoElement) {
             logoElement.style.display = 'none';
             document.getElementById('logoFallback').style.display = 'flex';
          }

          // Company details
          updateElement("industry", profile.industry || "Real Estate Investment Trust (REIT)");
          updateElement("founded", profile.ipoDate ? profile.ipoDate.substring(0, 4) : "2016");
          updateElement("hq", `${profile.city || "San Diego"}, ${profile.state || "CA"}, ${profile.country || "USA"}`);
          updateElement(
            "website",
            profile.website
              ? `<a href="${profile.website}" target="_blank">${profile.website} <i class="fas fa-external-link-alt" style="font-size: 0.8em;"></i></a>`
              : "N/A",
            true
          );
          updateElement("description", profile.description || "Innovative Industrial Properties, Inc. is a self-advised Maryland corporation focused on the acquisition, ownership and management of specialized industrial properties leased to experienced, state-licensed operators for their regulated medical-use cannabis facilities.");

          // Financial Metrics
          updateElement("marketCap", `$${formatNumber(quote.marketCap)}`);
          updateElement("revenue", `$${formatNumber(metrics.revenuePerShareTTM * quote.sharesOutstanding || 0)}`);
          updateElement("peRatio", `${formatNumber(quote.pe || 0)}x`);
          updateElement(
            "dividendYield",
            metrics.dividendYieldTTM
              ? `${(metrics.dividendYieldTTM * 100).toFixed(2)}%`
              : `${(profile.lastDiv / quote.price * 100).toFixed(2)}%` // Fallback calculation
          );
          updateElement(
            "payoutRatio",
            metrics.payoutRatioTTM
              ? `${(metrics.payoutRatioTTM * 100).toFixed(2)}%`
              : "N/A"
          );
          updateElement(
            "debtToAssets",
            metrics.debtToAssetsTTM
              ? `${(metrics.debtToAssetsTTM * 100).toFixed(2)}%`
              : "N/A"
          );

          // Stock Performance
          updateElement("currentPrice", `$${formatNumber(quote.price, 2)}`);
          
          // Format day's change with color
          const change = quote.change || 0;
          const changePercent = quote.changesPercentage || 0;
          const changeColor = change >= 0 ? "var(--success-color)" : "var(--danger-color)";
          const changeIcon = change >= 0 ? '<i class="fas fa-arrow-up"></i>' : '<i class="fas fa-arrow-down"></i>';
          
          updateElement(
            "dayChange",
            `<span style="color: ${changeColor};">${changeIcon} $${Math.abs(change).toFixed(2)} (${changePercent.toFixed(2)}%)</span>`,
            true
          );
          
          updateElement(
            "52WeekRange",
            `$${formatNumber(quote.yearLow, 2)} - $${formatNumber(quote.yearHigh, 2)}`
          );
          
          updateElement("pbRatio", `${formatNumber(metrics.priceToBookRatioTTM || quote.priceToBookRatio || 0)}x`);
          updateElement("avgVolume", formatNumber(quote.avgVolume || 0, 0));
          
          // Beta (if available)
          if (profile.beta !== undefined) {
            const betaValue = profile.beta;
            let betaDesc = "";
            if (betaValue < 0.8) betaDesc = " (Lower volatility than market)";
            else if (betaValue > 1.2) betaDesc = " (Higher volatility than market)";
            else betaDesc = " (Similar volatility to market)";
            
            updateElement("beta", `${betaValue.toFixed(2)}${betaDesc}`);
          } else {
            // If beta not available, hide the container
            const betaContainer = document.getElementById("betaContainer");
            if (betaContainer) betaContainer.style.display = "none";
          }

          // Update football field valuation
          updateFootballField(quote.price);

          // --- Create Price Chart ---
          if (historyData && historyData.historical && historyData.historical.length > 0) {
            // Sort and prepare data
            const historical = historyData.historical.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            // Get only last year of data for cleaner chart
            const oneYearAgo = new Date();
            oneYearAgo.setFullYear(oneYearAgo.getFullYear() - 1);
            
            const filteredData = historical.filter(entry => new Date(entry.date) >= oneYearAgo);
            
            const dates = filteredData.map(entry => entry.date);
            const prices = filteredData.map(entry => entry.close);
            
            // Find 52-week high and low points for highlighting
            const max = Math.max(...prices);
            const min = Math.min(...prices);
            const maxIndex = prices.indexOf(max);
            const minIndex = prices.indexOf(min);
            
            // Create annotations for high and low points
            const annotations = [
              {
                x: dates[maxIndex],
                y: max,
                text: '52-Week High',
                showarrow: true,
                arrowhead: 2,
                arrowcolor: 'var(--success-color)',
                arrowsize: 1,
                ax: -40,
                ay: -40,
                font: { color: 'var(--success-color)' }
              },
              {
                x: dates[minIndex],
                y: min,
                text: '52-Week Low',
                showarrow: true,
                arrowhead: 2,
                arrowcolor: 'var(--danger-color)',
                arrowsize: 1,
                ax: 40,
                ay: 40,
                font: { color: 'var(--danger-color)' }
              }
            ];
            
            // Current price reference line
            const currentPrice = quote.price;
            
            // Main price trace
            const trace = {
              x: dates,
              y: prices,
              type: 'scatter',
              mode: 'lines',
              line: { 
                color: 'var(--primary-color)',
                width: 3
              },
              name: 'Stock Price'
            };
            
            // Add area under the line for visual appeal
            const areaTrace = {
              x: dates,
              y: prices,
              fill: 'tozeroy',
              fillcolor: 'rgba(45, 106, 79, 0.1)',
              line: { width: 0 },
              type: 'scatter',
              mode: 'none',
              showlegend: false
            };
            
            // Reference line for current price
            const currentPriceLine = {
              x: dates,
              y: Array(dates.length).fill(currentPrice),
              type: 'scatter',
              mode: 'lines',
              line: {
                color: 'rgba(0, 0, 0, 0.7)',
                width: 2,
                dash: 'dot'
              },
              name: 'Current Price'
            };
            
            const layout = {
              xaxis: {
                title: 'Date',
                showgrid: false,
                zeroline: false,
                rangeslider: { visible: false }
              },
              yaxis: {
                title: 'Price (USD)',
                showgrid: true,
                gridcolor: 'rgba(0, 0, 0, 0.05)',
                zeroline: false
              },
              margin: { l: 50, r: 20, t: 40, b: 60 },
              paper_bgcolor: 'rgba(0,0,0,0)',
              plot_bgcolor: 'rgba(0,0,0,0)',
              annotations: annotations,
              hovermode: 'closest',
              legend: {
                orientation: 'h',
                y: 1.1,
                x: 0.5,
                xanchor: 'center'
              },
              title: {
                text: 'IIPR Stock Price - Past 12 Months',
                font: {
                  family: 'Poppins, sans-serif',
                  size: 16
                }
              }
            };
            
            const config = {
              responsive: true, 
              displayModeBar: 'hover',
              displaylogo: false,
              modeBarButtonsToRemove: ['lasso2d', 'select2d', 'toggleSpikelines']
            };
            
            Plotly.newPlot('priceChart', [areaTrace, trace, currentPriceLine], layout, config);
          } else {
            updateElement("priceChart", "<div class='error-message'><i class='fas fa-exclamation-triangle'></i> Could not load price chart data. Please try again later.</div>", true);
          }

          // Create Valuation Chart (static example)
          const valuationChartData = [
            {
              x: ['P/E Multiple', 'P/AFFO Multiple', 'DCF Analysis', 'NAV Approach'],
              y: [110, 115, 105, 100],
              name: 'Low Estimate',
              type: 'bar',
              marker: { color: 'rgba(220, 53, 69, 0.6)' }
            },
            {
              x: ['P/E Multiple', 'P/AFFO Multiple', 'DCF Analysis', 'NAV Approach'],
              y: [20, 14, 23, 25],
              name: 'High Estimate',
              type: 'bar',
              marker: { color: 'rgba(25, 135, 84, 0.6)' }
            }
          ];

          const valuationLayout = {
            title: 'Valuation Methodologies (Price Targets)',
            barmode: 'stack',
            yaxis: { title: 'Price Target ($)' },
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            margin: { l: 50, r: 20, t: 60, b: 60 },
            showlegend: true,
            legend: { orientation: 'h', y: 1.1 }
          };

          Plotly.newPlot('valuationChart', valuationChartData, valuationLayout);

        } catch (error) {
          console.error("Error fetching or processing data:", error);
          showError(`Failed to load complete data: ${error.message}. Some information may be missing or incomplete.`);
          
          // Clear loading states to prevent eternal loading indicators
          document.querySelectorAll('.loading').forEach(el => {
            el.classList.remove('loading');
            el.textContent = 'Data unavailable';
          });
          
          updateElement("priceChart", `<div class='error-message'><i class='fas fa-chart-line'></i> Chart data could not be loaded: ${error.message}</div>`, true);
        }
      }

      // --- Initialize the page ---
      document.addEventListener("DOMContentLoaded", fetchData);
    </script>
  </body>
</html>
